<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Config Manager</title>
    <link rel="stylesheet" href="config-manager-style.css">
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
</head>
<body>
    <h1>Config Manager Test</h1>

    <div id="tableSelectorContainer"></div>
    <div id="configList"></div>
    <form id="configForm">
        <input type="hidden" id="recordIdInput">
        <input type="text" id="configIdInput" placeholder="Config ID">
        <input type="text" id="descriptionInput" placeholder="Description">
        <div id="genericJsonEditor">
            <label for="configJsonTextarea">JSON da Configuração (configJson)</label>
            <textarea id="configJsonTextarea"></textarea>
        </div>
        <div id="drawerEditor">
            <h3 id="editorHeader"></h3>
            <div id="specializedEditorContainer"></div>
        </div>
        <button type="submit" id="saveBtn">Save</button>
        <button type="button" id="deleteBtn">Delete</button>
    </form>
    <div id="loadingMessage" style="display: none;">Loading...</div>
    <div id="errorMessage" style="display: none;"></div>
    <button id="newConfigBtn">New Config</button>
    <select id="newConfigTypeSelector">
        <option value="CardSystem">CardSystem</option>
        <option value="Drawer">Drawer</option>
        <option value="Table System">Table System</option>
    </select>

    <script type="module">
        import { CardConfigEditor } from './editors/config-cards.js';
        window.CardConfigEditor = CardConfigEditor;
        import('/custom-grist-widgets/ConfigManager/config-manager-widget.js');

        grist.ready().then(() => {
            const dummyConfig = {
                id: 'dummy-config',
                configId: 'dummy-config',
                description: 'Dummy CardSystem config for testing',
                componentType: 'CardSystem',
                configJson: JSON.stringify({
                    layout: [
                        {
                            colId: 'RefListField',
                            row: 0,
                            col: 0,
                            colSpan: 10,
                            rowSpan: 1,
                            style: {
                                useGristStyle: true,
                                refListConfig: {
                                    columns: Array.from({ length: 50 }, (_, i) => `col_${i}`)
                                }
                            }
                        }
                    ],
                    fields: [
                        {
                            colId: 'RefListField',
                            type: 'RefList:SomeTable',
                            label: 'My RefList'
                        }
                    ]
                })
            };

            // This is a simplified way to get the config manager to display the editor
            // We are not fully initializing the config manager, just enough to test the editor
            const specializedEditorContainerEl = document.getElementById('specializedEditorContainer');
            const tableLens = new GristTableLens(grist);
            const tableId = 'SomeTable'; // Dummy table id
            const allConfigs = [dummyConfig];

            // Mock getTableSchema to avoid errors
            tableLens.getTableSchema = async () => {
                const schema = {};
                for (let i = 0; i < 50; i++) {
                    schema[`col_${i}`] = { colId: `col_${i}`, type: 'Text', label: `Column ${i}` };
                }
                return schema;
            };

            CardConfigEditor.render(specializedEditorContainerEl, JSON.parse(dummyConfig.configJson), tableLens, tableId, allConfigs);
        });
    </script>
</body>
</html>